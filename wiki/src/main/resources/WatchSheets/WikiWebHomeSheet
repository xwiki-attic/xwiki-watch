<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>WatchSheets</web>
<name>WikiWebHomeSheet</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1194435959000</creationDate>
<date>1196763147000</date>
<contentUpdateDate>1196763147000</contentUpdateDate>
<version>1.3</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>WatchSheets.WikiWebHomeSheet</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>1 $msg.get("watch.title")
#startfloatingbox()
#set($params = $xwiki.arrayList)
#set($dispose = $params.add("[$msg.get('watch.wiki.reader') &gt; Reader]"))
$msg.get("watch.wiki.reader.goto", $params)
#endfloatingbox()
$msg.get("watch.introduction")
&lt;div style="float: left; width: 50%;"&gt;
#set($feedsTitle = $msg.get("watch.wiki.feeds"))
#set($articlesTitle = $msg.get("watch.wiki.articles"))
##* [$feedsTitle &gt; ${doc.fullName}#H${feedsTitle}]
##* [$articlesTitle &gt; ${doc.fullName}#H${articlesTitle}]
1.1 $feedsTitle
#set($aggregatorsSql = ", BaseObject obj where doc.fullName=obj.name and obj.className='XWiki.AggregatorURLClass' and doc.web='${doc.space}' order by doc.creationDate desc")
#set($list = $xwiki.searchDocuments($aggregatorsSql))
#set($noFilter = true)
#includeForm("XWiki.Results")
##create the keywords list and print them
&lt;div style="border:1px solid #CCCCCC; margin: 10px 10px 10px 0; padding:10px; background-color:#E4F6FF;"&gt;
#set($keywordsSql = ", BaseObject obj where doc.fullName = obj.name and obj.className = 'XWiki.KeywordClass' and doc.web = '${doc.space}'")
#set($keywordsDocList = $xwiki.searchDocuments($keywordsSql))
1.1 $msg.get("watch.wiki.keywords")
#if ($keywordsDocList.size() &gt; 0)
  &lt;ul&gt;
  #foreach($keywordDocName in $keywordsDocList)
    #set($keywordDoc = $xwiki.getDocument($keywordDocName))
    #set($keywordObj = $keywordDoc.getObject("XWiki.KeywordClass"))
    ##build the nice name
    #set($keywordName = "${keywordObj.getProperty('name').value}")
    #set($keywordGroup = false)
    #set($keywordGroup =  $keywordObj.display('group', 'view'))
    #if ($keywordGroup &amp;&amp; $keywordGroup != "")
      #set($keywordName = "${keywordName} - ${keywordGroup}")
    #end
    &lt;li&gt;&lt;a href="${keywordDoc.getURL()}"&gt;${keywordName}&lt;/a&gt;&lt;/li&gt;
  #end
  &lt;/ul&gt;
#end
&lt;/div&gt;
##get the tags to build the tags cloud
&lt;div style="border:1px solid #CCCCCC; margin: 10px 10px 10px 0; padding:10px; background-color:#E4F6FF;"&gt;
1.1 $msg.get("watch.wiki.tags")
##get the query from the document
#set($tagsQuery = "select elements(entry.tags), count(*) from XWiki.FeedEntryClass as entry, XWikiDocument as doc, BaseObject as obj where doc.fullName=obj.name and obj.id=entry.id and doc.web='${doc.space}' group by col_0_0_")
##execute
#set($tagsList = $xwiki.search($tagsQuery))
##get the TagSheet document to print the tag
#set($tagDocument = $xwiki.getDocument("WatchSheets.TagsSheet")) 
#foreach($tagEntry in $tagsList)
  #set($tagName = false)
  #set($tagCount = false)
  #foreach($tagVal in $tagEntry)
    #if ($velocityCount == 1)
      #set($tagName = $tagVal)
    #end
    #if ($velocityCount == 2)
      #set($tagCount = $tagVal)
    #end
  #end
  #set($fontSize = 100 + ($tagCount - 1) * 10)
  #if ($fontSize &gt; 1000)
    #set($fontSize = 1000)
  #end
  &lt;a style="font-size: ${fontSize}%;" href="${tagDocument.getURL("view", "&amp;tag=${tagName}")}"&gt;$tagName&lt;/a&gt;
#end
&lt;/div&gt;
&lt;/div&gt;
&lt;div style="float: left; width: 50%;"&gt;
&lt;div style="border:1px solid #CCCCCC; margin: 10px 0px 10px 10px; padding:10px; background-color:#E4F6FF;"&gt;
#set($prDoc = $xwiki.getDocument("WatchCode.PressReview"))
1.1 $msg.get("watch.wiki.articles.flagged")
#set($url = $prDoc.getExternalURL("view", "&amp;space=${doc.space}&amp;flagged=1&amp;read=0&amp;xpage=plain&amp;limit=15"))
$xwiki.getURLContent(${url})
&lt;/div&gt;
&lt;div style="border:1px solid #CCCCCC; margin: 10px 0px 10px 10px; padding:10px; background-color:#E4F6FF;"&gt;
1.1 $msg.get("watch.wiki.articles.unread")
#set($url = $prDoc.getExternalURL("view", "&amp;space=${doc.space}&amp;read=-1&amp;xpage=plain&amp;limit=15"))
$xwiki.getURLContent(${url})
&lt;/div&gt;
&lt;/div&gt;
&lt;div style="clear: both;"&gt;&lt;/div&gt;
#*
&lt;div style="width:50%;"&gt;
#set($articlesLimit = 100)
#set($articlesParam = $xwiki.arrayList)
#set($dispose = $articlesParam.add($articlesLimit))
1.1 $articlesTitle &amp;ndash; $msg.get("watch.wiki.articles.display", $articlesParam)
#set($articlesSql = ", BaseObject obj where doc.fullName=obj.name and obj.className='XWiki.FeedEntryClass' and doc.web='${doc.space}' order by doc.creationDate desc")
#set($list = $xwiki.searchDocuments($articlesSql, $articlesLimit, 0))
#set($noFilter = false)
#includeForm("XWiki.Results")
&lt;/div&gt;
*#</content>
</xwikidoc>
